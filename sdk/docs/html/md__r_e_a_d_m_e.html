<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lumasonic Decoder SDK: Decoder API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Lumasonic Decoder SDK<span id="projectnumber">&#160;1.0.2</span>
   </div>
   <div id="projectbrief">API for the Lumasonic Decoder library</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Decoder API</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md95"></a></p>
<h1><a class="anchor" id="autotoc_md96"></a>
Library Structure</h1>
<hr  />
<h2><a class="anchor" id="autotoc_md98"></a>
Header Include Files</h2>
<p>The following API header files are part of the SDK:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_common_8h.html">LumasonicCommon.h</a>   </td><td class="markdownTableBodyNone">defines common values and classes used by the API    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_decoder_8h.html">LumasonicDecoder.h</a>   </td><td class="markdownTableBodyNone">the main include file of the C++ decoder library    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_decoder_api_8h.html">LumasonicDecoderApi.h</a>   </td><td class="markdownTableBodyNone">the main include file of the decoder C API    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_stereo_decoder_8h.html">LumasonicStereoDecoder.h</a>   </td><td class="markdownTableBodyNone">interface for the main decoder class    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_stereo_reader_8h.html">LumasonicStereoReader.h</a>   </td><td class="markdownTableBodyNone">threaded reader class for consuming decoded color data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_stereo_udp_listener_8h.html">LumasonicStereoUdpListener.h</a>   </td><td class="markdownTableBodyNone">listener that relays stereo color values over a UDP socket    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="_lumasonic_utils_8h.html">LumasonicUtils.h</a>   </td><td class="markdownTableBodyNone">utility classes and methods useful for testing the decoder   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md99"></a>
Static Library Files</h2>
<p>In the Lumasonic SDK Decoder package you received there will be a top-level directory <a href="../../lib">/libs</a> which will contain the precompiled static libraries and the API header <code>.h</code> files.</p>
<p>The static library binaries will be separated in further subdirectories based on target architecture.</p>
<p>The SDK static library files have the following platform-specific naming convention:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File Name   </th><th class="markdownTableHeadNone">Operating System    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">LumasonicDecoder.lib   </td><td class="markdownTableBodyNone">Windows    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">libLumasonicDecoder.a   </td><td class="markdownTableBodyNone">macOS    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">libLumasonicDecoder.a   </td><td class="markdownTableBodyNone">Linux   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md100"></a>
Building</h1>
<h2><a class="anchor" id="autotoc_md101"></a>
Includes</h2>
<p>The main file that needs to be included in your project source code to build against the SDK library is <code><a class="el" href="_lumasonic_decoder_8h.html">LumasonicDecoder.h</a></code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_lumasonic_decoder_8h.html">LumasonicDecoder.h</a>&gt;</span></div>
<div class="ttc" id="a_lumasonic_decoder_8h_html"><div class="ttname"><a href="_lumasonic_decoder_8h.html">LumasonicDecoder.h</a></div></div>
</div><!-- fragment --><p>Make sure the Lumasonic Decoder <a href="../../lib/include/LumasonicDecoder">include</a> directory is added to your project's header search paths.</p>
<p>Add the library <b><code>LumasonicDecoder</code></b> to your project and ensure the location of the precompiled static binaries has been added to your project's library search paths.</p>
<h2><a class="anchor" id="autotoc_md102"></a>
Building on Linux</h2>
<p>On Linux you may need to specifically include the following libraries to the linker when linking against the Lumasonic Decoder library:</p>
<ul>
<li>libdl</li>
<li>libpthread</li>
</ul>
<p>If you get linking errors while building against the <code>LumasonicDecoder</code> library, try these linker arguments:</p>
<div class="fragment"><div class="line">-ldl, -pthread (or -lpthread) </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md103"></a>
Using the Decoder</h1>
<p>The <code><a class="el" href="class_lumasonic_stereo_decoder.html" title="A Lumasonic decoder for stereo audio streams.">LumasonicStereoDecoder</a></code> is the only class needed to decode <a href="https://docs.cymaticsomatics.com/docs/latest/lumasonic">Lumasonic</a> encoded signals. This class is meant to be used from within an application's <a href="http://www.rossbencina.com/code/real-time-audio-programming-101-time-waits-for-nothing">realtime audio thread</a>. Simply pass it buffers of stereo audio samples that have Lumasonic or AudioStrobe encoding, and it will decode the control signals and return the normalized values for downstream use.</p>
<p>Access to the decoded values is designed with realtime audio safety in mind, and all methods for reading decoded values are <b>lock free</b> &amp; <b>wait free</b>.</p>
<h2><a class="anchor" id="autotoc_md104"></a>
Creating a Decoder</h2>
<p>Create a new instance of the decoder using the following code:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>* lsDecoder = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_decoder.html">LumasonicStereoDecoder</a>();</div>
<div class="ttc" id="aclass_lumasonic_stereo_decoder_html"><div class="ttname"><a href="class_lumasonic_stereo_decoder.html">LumasonicStereoDecoder</a></div><div class="ttdoc">A Lumasonic decoder for stereo audio streams.</div><div class="ttdef"><b>Definition</b> LumasonicStereoDecoder.h:172</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md105"></a>
Initializing the Decoder</h2>
<p>The decoder must be initialized to a specific <b>sample rate</b> and <b>audio buffer size</b> before it can be used. The <code><a class="el" href="class_lumasonic_stereo_decoder.html#ab9f97723c7ed55f7c9a29b62bb7b7383" title="Initializes the decoder with the given sample rate and audio sample buffer size. This method should b...">LumasonicStereoDecoder::reset(float, int)</a></code> method can be called any time to reinitialize the decoder to new settings.</p>
<div class="fragment"><div class="line">lsDecoder-&gt;reset(48000.f, 256); <span class="comment">// 48 KHz sample rate, 256 sample buffer size</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md106"></a>
Decoding Audio</h2>
<p>The decoder can be used in non-realtime applications but this API generally assumes use in a realtime audio environment.</p>
<p>In your audio processing callback use the <code><a class="el" href="class_lumasonic_stereo_decoder.html#a12ae5bf40793dac6bc8c142c3b751dfd" title="Processes a block of audio through the decoder.">LumasonicStereoDecoder::processBlock(const float*, const float*, int)</a></code> method to decode buffers of stereo audio.</p>
<p>The left and right audio buffer arguments should point to 32-bit floating point audio samples.</p>
<p>The <b><code>numSamples</code></b> argument sets the number of samples in each buffer to process.</p>
<div class="fragment"><div class="line"><span class="comment">// (const float*) &#39;bufferL&#39; and &#39;bufferR&#39; are pointers to the left/right audio samples</span></div>
<div class="line"><span class="comment">// (int) &#39;numSamples&#39; is the total number of samples in the buffers to process </span></div>
<div class="line">lsDecoder-&gt;processBlock(bufferL, bufferR, numSamples);</div>
</div><!-- fragment --><p>Every time a new stereo color sample has been decoded from the audio, it is queued into the decoder's circular FIFO buffer. Stereo color samples should be consumed on a non-audio thread.</p>
<dl class="section note"><dt>Note</dt><dd>If stereo color samples are not consumed quickly enough, older entries will eventually be overwritten by newer entries.</dd></dl>
<hr  />
<h2><a class="anchor" id="autotoc_md108"></a>
Reading Decoded Values</h2>
<p>As audio decoding occurs on the audio thread <code>stereo color samples</code> will be queued into the decoder's internal buffer.</p>
<dl class="section note"><dt>Note</dt><dd>Decoded color samples should only be read by a <b>single non-audio consumer thread</b>.</dd></dl>
<p>Consuming the generated color samples is thread-safe, lock-free, and wait-free when preformed from a single consumer thread. This ensures no glitches or issues on the audio thread, which has restrictive realtime requirements.</p>
<p>To consume/pop a stereo color sample from the decoder call <code><a class="el" href="class_lumasonic_stereo_decoder.html#a67903d8aa1a45a82a4f75cc8d03a2688" title="Pops the next available stereo color sample from the decoded buffer. This method is thread-safe/atomi...">LumasonicStereoDecoder::popColorSample</a>(<a class="el" href="struct_stereo_color_sample.html" title="Stores two sets of RGB floating point values and a timestamp.">StereoColorSample</a>&amp;)</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// Prepare to read decoded color samples</span></div>
<div class="line"><span class="keywordtype">int</span> totalSamples = 0;</div>
<div class="line"><a class="code hl_struct" href="struct_stereo_color_sample.html">StereoColorSample</a> sc;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// While samples are available, read them</span></div>
<div class="line"><span class="keywordflow">while</span> (lsDecoder-&gt;popColorSample(sc))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Use the sample values here</span></div>
<div class="line">    ++totalSamples;</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;ts:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#ae97da91e2299b97f2bd49c577a533903">ts</a> &lt;&lt; </div>
<div class="line">        <span class="stringliteral">&quot;r0:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#a78401decf7b4b059e0222d2b02b6bfbc">r0</a> &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;g0:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#aac396b0164cdf94e4cbf8e98a9a82712">g0</a> &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;b0:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#ac6f62f6bfd750fca724e4ecd5ddea9b2">b0</a> &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;r1:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#a85de1eed73d22f5989f7fccfc3b164e6">r1</a> &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;g1:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#ab48e1d8ba875c2ef077f7c6e2eccf574">g1</a> &lt;&lt;</div>
<div class="line">        <span class="stringliteral">&quot;b1:&quot;</span> &lt;&lt; sc.<a class="code hl_variable" href="struct_stereo_color_sample.html#a7ce88f7851036daf6e042752a311c38a">b1</a> &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Total samples decoded: &quot;</span> &lt;&lt; totalSamples &lt;&lt; std::endl; </div>
<div class="ttc" id="astruct_stereo_color_sample_html"><div class="ttname"><a href="struct_stereo_color_sample.html">StereoColorSample</a></div><div class="ttdoc">Stores two sets of RGB floating point values and a timestamp.</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:93</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_a78401decf7b4b059e0222d2b02b6bfbc"><div class="ttname"><a href="struct_stereo_color_sample.html#a78401decf7b4b059e0222d2b02b6bfbc">StereoColorSample::r0</a></div><div class="ttdeci">float r0</div><div class="ttdoc">red channel 0</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:119</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_a7ce88f7851036daf6e042752a311c38a"><div class="ttname"><a href="struct_stereo_color_sample.html#a7ce88f7851036daf6e042752a311c38a">StereoColorSample::b1</a></div><div class="ttdeci">float b1</div><div class="ttdoc">blue channel 1</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:124</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_a85de1eed73d22f5989f7fccfc3b164e6"><div class="ttname"><a href="struct_stereo_color_sample.html#a85de1eed73d22f5989f7fccfc3b164e6">StereoColorSample::r1</a></div><div class="ttdeci">float r1</div><div class="ttdoc">red channel 1</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:122</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_aac396b0164cdf94e4cbf8e98a9a82712"><div class="ttname"><a href="struct_stereo_color_sample.html#aac396b0164cdf94e4cbf8e98a9a82712">StereoColorSample::g0</a></div><div class="ttdeci">float g0</div><div class="ttdoc">green channel 0</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:120</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_ab48e1d8ba875c2ef077f7c6e2eccf574"><div class="ttname"><a href="struct_stereo_color_sample.html#ab48e1d8ba875c2ef077f7c6e2eccf574">StereoColorSample::g1</a></div><div class="ttdeci">float g1</div><div class="ttdoc">green channel 1</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:123</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_ac6f62f6bfd750fca724e4ecd5ddea9b2"><div class="ttname"><a href="struct_stereo_color_sample.html#ac6f62f6bfd750fca724e4ecd5ddea9b2">StereoColorSample::b0</a></div><div class="ttdeci">float b0</div><div class="ttdoc">blue channel 0</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:121</div></div>
<div class="ttc" id="astruct_stereo_color_sample_html_ae97da91e2299b97f2bd49c577a533903"><div class="ttname"><a href="struct_stereo_color_sample.html#ae97da91e2299b97f2bd49c577a533903">StereoColorSample::ts</a></div><div class="ttdeci">unsigned long long ts</div><div class="ttdoc">timestamp</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:118</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md109"></a>
Clearing Decoded Values</h2>
<p>To clear the decoder of its current buffer of decoded values call the <code><a class="el" href="class_lumasonic_stereo_decoder.html#a401f29ec00ab8088eb1e64fca454ce6d" title="Clears all decoded stereo color samples from the internal buffer. This method is thread-safe.">LumasonicStereoDecoder::clearColorSamples()</a></code> method.</p>
<div class="fragment"><div class="line">lsDecoder-&gt;clearColorSamples(); <span class="comment">// clear all decoded stereo color samples in the buffer; thread safe</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md110"></a>
Deleting a Decoder</h2>
<p>Once you are finished using a decoder, remove any references, and then delete the instance.</p>
<div class="fragment"><div class="line">lsDecoder-&gt;setReader(<span class="keyword">nullptr</span>);  <span class="comment">// if a reader was registered, unregister it</span></div>
<div class="line"><span class="keyword">delete</span> lsDecoder;               <span class="comment">// lsDecoder should be a pointer of LumasonicStereoDecoder*</span></div>
</div><!-- fragment --><p>If you are using a <code><a class="el" href="class_lumasonic_stereo_reader.html" title="A threaded StereoColorSample reader that safely consumes LumasonicStereoDecoder decoded color output ...">LumasonicStereoReader</a></code> to read from the decoder make sure to stop and shutdown the reader first, and then clear the decoder's reader reference:</p>
<div class="fragment"><div class="line">lsReader-&gt;stop();                 <span class="comment">// stop the reader&#39;s thread first</span></div>
<div class="line">lsReader-&gt;clearListeners();       <span class="comment">// clear all of the reader&#39;s listeners </span></div>
<div class="line">lsReader-&gt;setDecoder(<span class="keyword">nullptr</span>);    <span class="comment">// dereference the decoder from the reader</span></div>
<div class="line">lsDecoder-&gt;setReader(<span class="keyword">nullptr</span>);    <span class="comment">// dereference the reader from the decoder</span></div>
<div class="line"><span class="keyword">delete</span> lsReader;                  <span class="comment">// delete the reader if no longer needed</span></div>
<div class="line"><span class="keyword">delete</span> lsDecoder;                 <span class="comment">// it is now safe to delete the decoder instance</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md111"></a>
Configuring a Log File</h2>
<p>By default, the Lumasonic decoder will output some information to standard output. If you would rather route its logging to a log file, pass in the absolute log file path to the constructor of <code><a class="el" href="class_lumasonic_stereo_decoder.html#a3dc5f9de36c96ba79d948b444db199b2" title="Constructor.">LumasonicStereoDecoder::LumasonicStereoDecoder()</a></code>:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>* lsDecoder = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_decoder.html">LumasonicStereoDecoder</a>(<span class="stringliteral">&quot;~/.lumasonic/decoder.log&quot;</span>);</div>
</div><!-- fragment --><p>Optionally, you can also pass in the maximum size (in bytes) of the log file as the second constructor argument to create and its size will be truncated as it grows.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a decoder with a log file that is truncated at 5MB </span></div>
<div class="line"><span class="keyword">auto</span>* lsDecoder = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_decoder.html">LumasonicStereoDecoder</a>(<span class="stringliteral">&quot;~/.lumasonic/decoder.log&quot;</span>, 5000000); </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md112"></a>
Safely Releasing a Log File</h2>
<p>If you configured the use of a log file, after the last decoder instance has been deleted, call the following method:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="class_lumasonic_stereo_decoder.html#a14006357b0b2091dcf35b0901771f383">LumasonicStereoDecoder::stopLogging</a>(); <span class="comment">// this releases the file logger and ensures no memory leaks</span></div>
<div class="ttc" id="aclass_lumasonic_stereo_decoder_html_a14006357b0b2091dcf35b0901771f383"><div class="ttname"><a href="class_lumasonic_stereo_decoder.html#a14006357b0b2091dcf35b0901771f383">LumasonicStereoDecoder::stopLogging</a></div><div class="ttdeci">static void stopLogging()</div><div class="ttdoc">Call this after removing all instances of LumasonicStereoDecoder if a file logger was configured when...</div></div>
</div><!-- fragment --><p>This will ensure no memory is leaked by closing and destroying the internal file logger.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md114"></a>
Adjusting Output Brightness</h2>
<p>To set the global output brightness of the decoder, use the <code><a class="el" href="class_lumasonic_stereo_decoder.html#a5380c9d4d79ddea656e66bb5a4db8b57" title="Sets the current output brightness level (0.0 - 1.0). This method is thread-safe/atomic.">LumasonicStereoDecoder::setBrightness(float)</a></code> method and pass a value between <b>0.0</b> and <b>1.0</b>:</p>
<div class="fragment"><div class="line">lsDecoder-&gt;setBrightness(0.75f); <span class="comment">// set the output brightness to 75%</span></div>
</div><!-- fragment --><p>To get the current output brightness value (also between <b>0.0</b> and <b>1.0</b>) use the equivalent get method <code><a class="el" href="class_lumasonic_stereo_decoder.html#acc7f20d43428e5cceb07b50acb1f2c9d" title="Gets the current output brightness level (0.0 - 1.0). This method is thread-safe/atomic.">LumasonicStereoDecoder::getBrightness()</a></code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> brightness = lsDecoder-&gt;getBrightness();</div>
</div><!-- fragment --><p>These calls are thread-safe and can be called from any thread, audio or non-audio.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md116"></a>
Detecting AudioStrobe</h2>
<p>When the current audio stream does not contain a steady Lumasonic reference tone, at or above <b>-55 dB</b>, then it is considered to be an AudioStrobe stream.</p>
<dl class="section note"><dt>Note</dt><dd>The volume level of the reference tone is averaged/filtered over time to prevent subtle and quick fluctuation from creating noisy color output. A small amount of time is required for the reference tone level to settle when processing.</dd></dl>
<p>To check whether the current audio stream is detected as AudioStrobe call the <code><a class="el" href="class_lumasonic_stereo_decoder.html#a6a73a038f97a39cc94b8b53e22c01c12" title="Whether the current stream is detected as AudioStrobe. This method is thread-safe/atomic.">LumasonicStereoDecoder::isAudioStrobe()</a></code> method of the decoder:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> audioStrobeDetected = lsDecoder-&gt;isAudioStrobe(); </div>
</div><!-- fragment --><p>This call is thread-safe and can be called from any thread, audio or non-audio.</p>
<h1><a class="anchor" id="autotoc_md117"></a>
Using the Reader</h1>
<p>The <code><a class="el" href="class_lumasonic_stereo_reader.html" title="A threaded StereoColorSample reader that safely consumes LumasonicStereoDecoder decoded color output ...">LumasonicStereoReader</a></code> is intended as a complimentary class to the <code><a class="el" href="class_lumasonic_stereo_decoder.html" title="A Lumasonic decoder for stereo audio streams.">LumasonicStereoDecoder</a></code> class, and is used for safely and quickly consuming decoded stereo color values and dispatching them to other control systems such as LEDs or visual output.</p>
<p>The reader implements its own internal reading thread which retrieves data decoded on the <b>audio thread</b> and delivers the data to registered listeners on a <b>non-audio thread</b> so the data can be dispatched to other systems, including hardware I/O.</p>
<h2><a class="anchor" id="autotoc_md118"></a>
Creating a Reader</h2>
<p>Create a new instance of the reader using the following code:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span>* lsReader = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_reader.html">LumasonicStereoReader</a>();</div>
<div class="ttc" id="aclass_lumasonic_stereo_reader_html"><div class="ttname"><a href="class_lumasonic_stereo_reader.html">LumasonicStereoReader</a></div><div class="ttdoc">A threaded StereoColorSample reader that safely consumes LumasonicStereoDecoder decoded color output ...</div><div class="ttdef"><b>Definition</b> LumasonicStereoReader.h:147</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md119"></a>
Reader Thread Modes</h2>
<p>The reader implements three different selectable thread modes which each offer different performance and timing trade-offs:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Thread Mode   </th><th class="markdownTableHeadNone">Enum Value   </th><th class="markdownTableHeadNone">CPU Usage   </th><th class="markdownTableHeadNone">Timing &amp; Jitter   </th><th class="markdownTableHeadNone">Realtime Safe    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Safe   </td><td class="markdownTableBodyNone">LS_Thread_Sleep   </td><td class="markdownTableBodyNone">Low   </td><td class="markdownTableBodyNone">Good   </td><td class="markdownTableBodyNone">Yes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Efficient   </td><td class="markdownTableBodyNone">LS_Thread_Event   </td><td class="markdownTableBodyNone">Lowest   </td><td class="markdownTableBodyNone">Great   </td><td class="markdownTableBodyNone">No    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Performance   </td><td class="markdownTableBodyNone">LS_Thread_Loop   </td><td class="markdownTableBodyNone">Highest   </td><td class="markdownTableBodyNone">Best   </td><td class="markdownTableBodyNone">Yes   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>While the <b>Efficient</b> mode is not strictly realtime audio safe, in practice it is quite reliable and has the best timing accuracy vs. CPU usage behavior.</dd></dl>
<p>To set the reader's thread mode use the <code><a class="el" href="class_lumasonic_stereo_reader.html#a4ce321b8d759923d6a3bd3938c0a537e" title="Sets the current reading thread mode. This method is thread-safe/atomic.">LumasonicStereoReader::setThreadMode()</a></code> method:</p>
<div class="fragment"><div class="line">lsReader-&gt;setThreadMode(<a class="code hl_enumvalue" href="_lumasonic_common_8h.html#abcb2c32fff335132a52a34ba587a92b6a5c7f2980fc4d80bdb1a5c8b94cc553e9">LumasonicThreadModes::LS_Thread_Loop</a>); <span class="comment">// set to performance mode</span></div>
<div class="ttc" id="a_lumasonic_common_8h_html_abcb2c32fff335132a52a34ba587a92b6a5c7f2980fc4d80bdb1a5c8b94cc553e9"><div class="ttname"><a href="_lumasonic_common_8h.html#abcb2c32fff335132a52a34ba587a92b6a5c7f2980fc4d80bdb1a5c8b94cc553e9">LumasonicThreadModes::LS_Thread_Loop</a></div><div class="ttdeci">@ LS_Thread_Loop</div><div class="ttdoc">An aggressive thread that loops without stopping waiting for data (best timing performance,...</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:178</div></div>
</div><!-- fragment --><p>Thread modes can be changed dynamically while a reader and decoder are running.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md121"></a>
Connecting a Reader to a Decoder</h2>
<p>Reader instances need to reference the decoder instance that they will read from.</p>
<p>When using the <b>Efficient</b> thread mode, it is also necessary for the decoder to reference the reader so that the decoder can notify it directly when there is more data to be read.</p>
<p>In general, it is best practice to always connect each instance to one another, even if you are not sure which thread modes you will use.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the Lumasonic decoder instance</span></div>
<div class="line"><span class="keyword">auto</span>* lsDecoder = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_decoder.html">LumasonicStereoDecoder</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the Lumasonic reader instance</span></div>
<div class="line"><span class="keyword">auto</span>* lsReader = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_reader.html">LumasonicStereoReader</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Hook up the reader and decoder</span></div>
<div class="line">lsReader-&gt;setDecoder(lsDecoder);</div>
<div class="line">lsDecoder-&gt;setReader(lsReader);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set the thread mode of the reader</span></div>
<div class="line">lsReader-&gt;setThreadMode(<a class="code hl_enumvalue" href="_lumasonic_common_8h.html#abcb2c32fff335132a52a34ba587a92b6a1b3c41c88efe93174517e964d7c10f54">LumasonicThreadModes::LS_Thread_Sleep</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start the reading thread</span></div>
<div class="line">lsReader-&gt;start();</div>
<div class="ttc" id="a_lumasonic_common_8h_html_abcb2c32fff335132a52a34ba587a92b6a1b3c41c88efe93174517e964d7c10f54"><div class="ttname"><a href="_lumasonic_common_8h.html#abcb2c32fff335132a52a34ba587a92b6a1b3c41c88efe93174517e964d7c10f54">LumasonicThreadModes::LS_Thread_Sleep</a></div><div class="ttdeci">@ LS_Thread_Sleep</div><div class="ttdoc">The thread will sleep by ~1 millisecond every loop while it waits for data; system sleep timing can i...</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:176</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md122"></a>
Reader Listeners</h2>
<p>Readers can have one or more <code><a class="el" href="struct_stereo_color_sample.html" title="Stores two sets of RGB floating point values and a timestamp.">StereoColorSample</a></code> consuming listeners registered.</p>
<p>Registered listeners will be notified when new decoded data is ready to be dispatched outside the audio thread.</p>
<h3><a class="anchor" id="autotoc_md123"></a>
Implementing the Listener Interface</h3>
<p>To receive and use decoded data as it becomes available classes should implement the <code><a class="el" href="class_lumasonic_stereo_color_listener.html" title="Interface for classes that will listen for available Lumasonic StereoColorSample data to become ready...">LumasonicStereoColorListener</a></code> interface:</p>
<div class="fragment"><div class="line"><span class="comment">// An example listener class that might update LED or screen visuals</span></div>
<div class="line"><span class="keyword">class </span>VisualsUpdater : <span class="keyword">private</span> <a class="code hl_class" href="class_lumasonic_stereo_color_listener.html">LumasonicStereoColorListener</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">     <span class="keywordtype">void</span> <a class="code hl_function" href="class_lumasonic_stereo_color_listener.html#a15c6231aa4429af9917f1f72628ff192">onStereoColorRead</a>(<a class="code hl_class" href="class_lumasonic_running_process.html">LumasonicRunningProcess</a>&amp; process, <a class="code hl_struct" href="struct_stereo_color_sample.html">StereoColorSample</a> stereoColor)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">     </span>{</div>
<div class="line">        <span class="comment">// TODO Implement custom logic here for using the decoded data</span></div>
<div class="line">         </div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line">        <span class="comment">// Only use this if the listener&#39;s callback needs to signal to the reader to abort reading.</span></div>
<div class="line">        <span class="comment">// This stops the reader&#39;s thread entirely so all registered listener&#39;s will stop receiving data.</span></div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------------------------------</span></div>
<div class="line">        process.<a class="code hl_function" href="class_lumasonic_running_process.html#adb099adc13bf3d0ead4d0124626902f7">signalProcessShouldExit</a>(); <span class="comment">// signals to the parent reader that it should stop reading</span></div>
<div class="line">     }</div>
<div class="line">};</div>
<div class="ttc" id="aclass_lumasonic_running_process_html"><div class="ttname"><a href="class_lumasonic_running_process.html">LumasonicRunningProcess</a></div><div class="ttdoc">Interface for classes that have their own thread which can be signaled for shutdown from a listener t...</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:333</div></div>
<div class="ttc" id="aclass_lumasonic_running_process_html_adb099adc13bf3d0ead4d0124626902f7"><div class="ttname"><a href="class_lumasonic_running_process.html#adb099adc13bf3d0ead4d0124626902f7">LumasonicRunningProcess::signalProcessShouldExit</a></div><div class="ttdeci">virtual void signalProcessShouldExit()=0</div><div class="ttdoc">Called by a listener within a running process to indicate that the process should exit.</div></div>
<div class="ttc" id="aclass_lumasonic_stereo_color_listener_html"><div class="ttname"><a href="class_lumasonic_stereo_color_listener.html">LumasonicStereoColorListener</a></div><div class="ttdoc">Interface for classes that will listen for available Lumasonic StereoColorSample data to become ready...</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:390</div></div>
<div class="ttc" id="aclass_lumasonic_stereo_color_listener_html_a15c6231aa4429af9917f1f72628ff192"><div class="ttname"><a href="class_lumasonic_stereo_color_listener.html#a15c6231aa4429af9917f1f72628ff192">LumasonicStereoColorListener::onStereoColorRead</a></div><div class="ttdeci">virtual void onStereoColorRead(LumasonicRunningProcess &amp;process, StereoColorSample stereoColor)=0</div><div class="ttdoc">This method is called when the reader&#39;s thread has new color data available.</div></div>
</div><!-- fragment --><p>If you need a listener to be able to issue a critical message for the reader to abort all reading and shutdown the reader thread, you listener callback can call the <code><a class="el" href="class_lumasonic_running_process.html#adb099adc13bf3d0ead4d0124626902f7" title="Called by a listener within a running process to indicate that the process should exit.">LumasonicRunningProcess::signalProcessShouldExit()</a></code> method.</p>
<h3><a class="anchor" id="autotoc_md124"></a>
Using Listeners with Readers</h3>
<p>One or more listeners can be added to a reader to be notified when data is ready. Here are some examples of working with listeners:</p>
<div class="fragment"><div class="line"><span class="comment">// API use examples</span></div>
<div class="line"><span class="keyword">auto</span>* lsReader = <span class="keyword">new</span> <a class="code hl_class" href="class_lumasonic_stereo_reader.html">LumasonicStereoReader</a>();</div>
<div class="line"><span class="keyword">auto</span>* visUpdater = <span class="keyword">new</span> VisualsUpdater();     <span class="comment">// example listener class</span></div>
<div class="line">lsReader-&gt;addListener(visUpdater);           <span class="comment">// add the listener instance to the reader</span></div>
<div class="line">lsReader-&gt;removeListener(visUpdater);        <span class="comment">// remove the listener instance from the reader when done</span></div>
<div class="line">lsReader-&gt;addListener(<span class="keyword">this</span>);                 <span class="comment">// if the owning class implements the listener interface</span></div>
<div class="line">lsReader-&gt;clearListeners();                  <span class="comment">// alternatively, remove all listeners at once</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md125"></a>
Deleting a Reader</h2>
<p>When a reader instance is no longer needed, use the following sequence:</p>
<div class="fragment"><div class="line">lsReader-&gt;stop();                            <span class="comment">// first, stop the reader thread</span></div>
<div class="line">lsReader-&gt;clearListeners();                  <span class="comment">// next, clear the list of listeners</span></div>
<div class="line">lsReader-&gt;setDecoder(<span class="keyword">nullptr</span>);               <span class="comment">// finally, clear the decoder pointer</span></div>
<div class="line"><span class="keyword">delete</span> lsReader;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Reader instances should be shutdown and deleted first, before deleting decoder instances.</dd></dl>
<h2><a class="anchor" id="autotoc_md126"></a>
Monitoring Reader Performance</h2>
<p><code><a class="el" href="class_lumasonic_stereo_reader.html" title="A threaded StereoColorSample reader that safely consumes LumasonicStereoDecoder decoded color output ...">LumasonicStereoReader</a></code> monitors the performance of its own timing which can be read to understand the timing and jitter characteristics of its operation.</p>
<p>To read timing performance data use the <code><a class="el" href="class_lumasonic_stereo_reader.html#a824a96f1692af80d358029c2777f3ef4" title="Reads and pops the next performance information from the buffer. This method is thread-safe.">LumasonicStereoReader::popPerfInfo()</a></code> method.</p>
<p>This method can be safely called from any thread.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_lumasonic_read_perf_info.html">LumasonicReadPerfInfo</a> info {};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (reader-&gt;popPerfInfo(info))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Access all of the timing performance values here</span></div>
<div class="line">    <span class="keyword">auto</span> avgThreadTimeMs = info.threadAverageTimeMs;  <span class="comment">// should be as low as possible</span></div>
<div class="line">    <span class="keyword">auto</span> avgDataTimeMs = info.dataAverageTimeMs;      <span class="comment">// should equal the audio frame time</span></div>
<div class="line">}</div>
<div class="ttc" id="astruct_lumasonic_read_perf_info_html"><div class="ttname"><a href="struct_lumasonic_read_perf_info.html">LumasonicReadPerfInfo</a></div><div class="ttdoc">Contains metrics related to Lumasonic data read performance.</div><div class="ttdef"><b>Definition</b> LumasonicCommon.h:303</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Use the <code><a class="el" href="class_lumasonic_stereo_reader.html#a4ce321b8d759923d6a3bd3938c0a537e" title="Sets the current reading thread mode. This method is thread-safe/atomic.">LumasonicStereoReader::setThreadMode()</a></code> method and <code><a class="el" href="class_lumasonic_stereo_reader.html#a824a96f1692af80d358029c2777f3ef4" title="Reads and pops the next performance information from the buffer. This method is thread-safe.">LumasonicStereoReader::popPerfInfo()</a></code> to test which mode provides the best performance trade-offs for your target integration.</dd></dl>
<h3><a class="anchor" id="autotoc_md127"></a>
Resetting a Monitoring Session</h3>
<p>To reset monitoring and clear the current timing data call the <code><a class="el" href="class_lumasonic_stereo_reader.html#af66132142312163285f1c38a45e337f9" title="Clears the current buffer of performance information.">LumasonicStereoReader::clearPerfInfo()</a></code> method.</p>
<div class="fragment"><div class="line">reader-&gt;clearPerfInfo(); <span class="comment">// clears all queued data and reset timing values</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md128"></a>
Using the C API</h1>
<h2><a class="anchor" id="autotoc_md129"></a>
The Lumasonic Codec</h2>
<p>The C API is based around a single global <a class="el" href="class_lumasonic_codec.html">Lumasonic codec</a> per process. The codec holds the state of one or more pairs of decoders and readers.</p>
<p>The C++ object oriented API is encapsulated by the codec as a flat set of C functions.</p>
<h2><a class="anchor" id="autotoc_md130"></a>
Linking</h2>
<p>The Lumasonic Decoder SDK can be accessed via the <b>C API</b> by using the <a class="el" href="_lumasonic_decoder_api_8h.html">LumasonicDecoderApi.h</a> header file.</p>
<dl class="section note"><dt>Note</dt><dd>When using the C API <b>DO NOT</b> include <b><a class="el" href="_lumasonic_decoder_8h.html">LumasonicDecoder.h</a> (C++)</b>. Only include <b><a class="el" href="_lumasonic_decoder_api_8h.html">LumasonicDecoderApi.h</a> (C)</b></dd></dl>
<p>It is possible to create cross-language bindings for the Lumasonic Decoder SDK by using the C API header file when linking against the decoder library.</p>
<h3><a class="anchor" id="autotoc_md131"></a>
Linking on Linux</h3>
<p>When linking against the library on Linux, it may be necessary to provide the following library flags to the linker:</p>
<div class="fragment"><div class="line">-lstdc++ -lm</div>
</div><!-- fragment --><p>These linker library flags might also be needed:</p>
<div class="fragment"><div class="line">-ldl -pthread (or -lpthread)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md132"></a>
Initializing the Codec</h2>
<dl class="section note"><dt>Note</dt><dd>The C codec must be initialized before it can be used</dd></dl>
<p>Use the <b><a class="el" href="_lumasonic_decoder_api_8h.html#a7bd863cfeb340e5a9bf26d5734d5e207" title="Initializes the global Lumasonic codec manager with a log file.">ls_codec_init(const char* log_path, int max_file_size)</a></b> function to initialize the codec:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a7bd863cfeb340e5a9bf26d5734d5e207">ls_codec_init</a>(<span class="keyword">nullptr</span>, 0); <span class="comment">// no log file; route to std out</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a7bd863cfeb340e5a9bf26d5734d5e207"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a7bd863cfeb340e5a9bf26d5734d5e207">ls_codec_init</a></div><div class="ttdeci">int ls_codec_init(const char *log_path, int max_file_size)</div><div class="ttdoc">Initializes the global Lumasonic codec manager with a log file.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md133"></a>
Decoder and Reader IDs</h3>
<p>After initialization, a default decoder and reader pair will exist and will be ready for configuration.</p>
<p>The reader is optional and you can use the decoder directly for reading values.</p>
<p>To get the ID of each:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> d_id = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a298cfa1b78d4892b88abb618cd9fd6bf">ls_decoder_get_main_id</a>(); <span class="comment">// get the ID of the main decoder instance</span></div>
<div class="line"><span class="keywordtype">int</span> r_id = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a2c6c38c71958cb1c3107434ba66deb12">ls_reader_get_main_id</a>();  <span class="comment">// get the ID of the main reader instance</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a298cfa1b78d4892b88abb618cd9fd6bf"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a298cfa1b78d4892b88abb618cd9fd6bf">ls_decoder_get_main_id</a></div><div class="ttdeci">int ls_decoder_get_main_id()</div><div class="ttdoc">Gets the ID of the main decoder (typically 0).</div></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a2c6c38c71958cb1c3107434ba66deb12"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a2c6c38c71958cb1c3107434ba66deb12">ls_reader_get_main_id</a></div><div class="ttdeci">int ls_reader_get_main_id()</div><div class="ttdoc">Gets the ID of the main reader (first index in the reader list).</div></div>
</div><!-- fragment --><p>The IDs are used with the C API function calls to specify which instance a particular function call is for. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> is_audiostrobe = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a2ae05acdc49650fb331965d1c22aad9a">ls_decoder_is_audiostrobe</a>(d_id); <span class="comment">// use the decoder ID from above to reference it</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a2ae05acdc49650fb331965d1c22aad9a"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a2ae05acdc49650fb331965d1c22aad9a">ls_decoder_is_audiostrobe</a></div><div class="ttdeci">bool ls_decoder_is_audiostrobe(int id)</div><div class="ttdoc">Whether the current stream is detected as AudioStrobe. This method is thread-safe/atomic.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md134"></a>
Initializing Decoders</h3>
<p>Decoders are initialized using their ID, sample rate, and audio buffer size using the <b><a class="el" href="_lumasonic_decoder_api_8h.html#aa2333a25b9d4ddc71c143dc3e2a1ba9e" title="Initializes the decoder with the given sample rate and audio sample buffer size.">ls_decoder_reset(int, float, int)</a></b> function.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#aa2333a25b9d4ddc71c143dc3e2a1ba9e">ls_decoder_reset</a>(d_id, 48000, 256); <span class="comment">// reset the decoder to 48 KHz and 256 buffer size </span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_aa2333a25b9d4ddc71c143dc3e2a1ba9e"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#aa2333a25b9d4ddc71c143dc3e2a1ba9e">ls_decoder_reset</a></div><div class="ttdeci">void ls_decoder_reset(int id, float sample_rate, int buffer_size)</div><div class="ttdoc">Initializes the decoder with the given sample rate and audio sample buffer size.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md135"></a>
Processing Audio</h2>
<p>To process stereo buffers of 32 bit floating point audio, use the <b><a class="el" href="_lumasonic_decoder_api_8h.html#a0786bbe961964ea7583318aa59409b3e" title="Processes a block of audio through the decoder.">ls_decoder_process_block(int, const float*, const float*, int)</a></b> function wherever you process realtime audio.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a0786bbe961964ea7583318aa59409b3e">ls_decoder_process_block</a>(d_id, buffer_left, buffer_right, 256); <span class="comment">// decode a block of 256 const float* audio samples</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a0786bbe961964ea7583318aa59409b3e"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a0786bbe961964ea7583318aa59409b3e">ls_decoder_process_block</a></div><div class="ttdeci">void ls_decoder_process_block(int id, const float *in0, const float *in1, int num_samples)</div><div class="ttdoc">Processes a block of audio through the decoder.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md136"></a>
Reading Decoded Audio</h2>
<p>The function <b><a class="el" href="_lumasonic_decoder_api_8h.html#a8dfdb056765ae79d672100c487f37c88" title="Pops the next available stereo color sample from the decoded buffer. This method is thread-safe/atomi...">ls_decoder_pop_color_sample(int)</a></b> will return a <b><a class="el" href="structstereo__color__sample.html">stereo_color_sample</a></b> struct.</p>
<p>If the <a class="el" href="structstereo__color__sample.html#a0701a86c62c3f575e14cf03d26696801">timestamp</a> of the returned stereo color sample equals <b>0</b> then there was <b>no data available</b>, which is similar to the equivalent C++ method returning <b>false</b>.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structstereo__color__sample.html">stereo_color_sample</a> sc = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a8dfdb056765ae79d672100c487f37c88">ls_decoder_pop_color_sample</a>(d_id); <span class="comment">// attempt to read a decoded sample</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// If data is available, use it...</span></div>
<div class="line"><span class="keywordflow">if</span> (sc.<a class="code hl_variable" href="structstereo__color__sample.html#a0701a86c62c3f575e14cf03d26696801">ts</a> != 0) {</div>
<div class="line">    <span class="keywordtype">float</span> red_left = sc.<a class="code hl_variable" href="structstereo__color__sample.html#a4f57d0cce093226b2458920dd8a4c9d4">r0</a>;</div>
<div class="line">    <span class="keywordtype">float</span> red_right = sc.<a class="code hl_variable" href="structstereo__color__sample.html#a681c0c4ece2877770854244fdbc444d0">r1</a>;</div>
<div class="line">}</div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a8dfdb056765ae79d672100c487f37c88"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a8dfdb056765ae79d672100c487f37c88">ls_decoder_pop_color_sample</a></div><div class="ttdeci">stereo_color_sample ls_decoder_pop_color_sample(int id)</div><div class="ttdoc">Pops the next available stereo color sample from the decoded buffer. This method is thread-safe/atomi...</div></div>
<div class="ttc" id="astructstereo__color__sample_html"><div class="ttname"><a href="structstereo__color__sample.html">stereo_color_sample</a></div><div class="ttdef"><b>Definition</b> LumasonicDecoderApi.h:60</div></div>
<div class="ttc" id="astructstereo__color__sample_html_a0701a86c62c3f575e14cf03d26696801"><div class="ttname"><a href="structstereo__color__sample.html#a0701a86c62c3f575e14cf03d26696801">stereo_color_sample::ts</a></div><div class="ttdeci">unsigned long long ts</div><div class="ttdoc">timestamp</div><div class="ttdef"><b>Definition</b> LumasonicDecoderApi.h:61</div></div>
<div class="ttc" id="astructstereo__color__sample_html_a4f57d0cce093226b2458920dd8a4c9d4"><div class="ttname"><a href="structstereo__color__sample.html#a4f57d0cce093226b2458920dd8a4c9d4">stereo_color_sample::r0</a></div><div class="ttdeci">float r0</div><div class="ttdoc">red channel 0</div><div class="ttdef"><b>Definition</b> LumasonicDecoderApi.h:62</div></div>
<div class="ttc" id="astructstereo__color__sample_html_a681c0c4ece2877770854244fdbc444d0"><div class="ttname"><a href="structstereo__color__sample.html#a681c0c4ece2877770854244fdbc444d0">stereo_color_sample::r1</a></div><div class="ttdeci">float r1</div><div class="ttdoc">red channel 1</div><div class="ttdef"><b>Definition</b> LumasonicDecoderApi.h:65</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md137"></a>
Creating Additional Decoders and Readers</h2>
<p>If you need to operate more than one decoder or reader at the same time, you can create new instances using <b><a class="el" href="_lumasonic_decoder_api_8h.html#a111516f889190489ff09d29d779639a0" title="Creates a new LumasonicStereoDecoder instance and returns its unique ID.">ls_decoder_create()</a></b> and <b><a class="el" href="_lumasonic_decoder_api_8h.html#ae8d71390cce26ed24aae5d7c1c5cb63a" title="Creates a new LumasonicStereoReader instance and returns its unique ID.">ls_reader_create()</a></b>.</p>
<p>These functions return the ID of the created instance (or a negative number if there was an error creating it).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> d_id = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a111516f889190489ff09d29d779639a0">ls_decoder_create</a>();     <span class="comment">// create a new decoder instance save its ID</span></div>
<div class="line"><span class="keywordtype">int</span> r_id = <a class="code hl_function" href="_lumasonic_decoder_api_8h.html#ae8d71390cce26ed24aae5d7c1c5cb63a">ls_reader_create</a>();      <span class="comment">// create a new reader instance save its ID</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a111516f889190489ff09d29d779639a0"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a111516f889190489ff09d29d779639a0">ls_decoder_create</a></div><div class="ttdeci">int ls_decoder_create()</div><div class="ttdoc">Creates a new LumasonicStereoDecoder instance and returns its unique ID.</div></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_ae8d71390cce26ed24aae5d7c1c5cb63a"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#ae8d71390cce26ed24aae5d7c1c5cb63a">ls_reader_create</a></div><div class="ttdeci">int ls_reader_create()</div><div class="ttdoc">Creates a new LumasonicStereoReader instance and returns its unique ID.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md138"></a>
Connecting Created Instances</h3>
<p>Use the <b><a class="el" href="_lumasonic_decoder_api_8h.html#a01d48241be61d8084b90dbf72ba8d7d0" title="Connects a decoder instance to a reader instance.">ls_codec_connect(int, int)</a></b> and <b><a class="el" href="_lumasonic_decoder_api_8h.html#a4ba0d4802cd14f671e3f9c55a2301eb6" title="Disconnects a decoder instance and a reader instance.">ls_codec_disconnect(int, int)</a></b> functions to connect and disconnect decoders and readers.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a01d48241be61d8084b90dbf72ba8d7d0">ls_codec_connect</a>(d_id, r_id);       <span class="comment">// connect the created decoder and reader together</span></div>
<div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a4ba0d4802cd14f671e3f9c55a2301eb6">ls_codec_disconnect</a>(d_id, r_id);    <span class="comment">// disconnect the decoder and reader</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a01d48241be61d8084b90dbf72ba8d7d0"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a01d48241be61d8084b90dbf72ba8d7d0">ls_codec_connect</a></div><div class="ttdeci">bool ls_codec_connect(int decoder_id, int reader_id)</div><div class="ttdoc">Connects a decoder instance to a reader instance.</div></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a4ba0d4802cd14f671e3f9c55a2301eb6"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a4ba0d4802cd14f671e3f9c55a2301eb6">ls_codec_disconnect</a></div><div class="ttdeci">bool ls_codec_disconnect(int decoder_id, int reader_id)</div><div class="ttdoc">Disconnects a decoder instance and a reader instance.</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The default decoder and reader pair that are created when the codec is initialized are automatically connected after creation.</dd></dl>
<h2><a class="anchor" id="autotoc_md139"></a>
Shutting Down the Codec</h2>
<p>The codec should be properly shutdown so it can free its resources. When you are ready to stop using the codec call <b><a class="el" href="_lumasonic_decoder_api_8h.html#a231e937cd7adc89f2c66e898ae508f32" title="Shuts down the global Lumasonic codec manager.">ls_codec_shutdown()</a></b>.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="_lumasonic_decoder_api_8h.html#a231e937cd7adc89f2c66e898ae508f32">ls_codec_shutdown</a>(); <span class="comment">// this will stop readers, disconnect, and then destroy decoders and readers</span></div>
<div class="ttc" id="a_lumasonic_decoder_api_8h_html_a231e937cd7adc89f2c66e898ae508f32"><div class="ttname"><a href="_lumasonic_decoder_api_8h.html#a231e937cd7adc89f2c66e898ae508f32">ls_codec_shutdown</a></div><div class="ttdeci">int ls_codec_shutdown()</div><div class="ttdoc">Shuts down the global Lumasonic codec manager.</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
